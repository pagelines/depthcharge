// ********
// DepthCharge Custom JS Engine
// Copyright etc.io
// Version: 1.0c
// All Rights Reserved
// ********
// Let's create an extendable object for each container (you'll be able to stack them in a russian doll as well)
function churnSmartPosition(e,t){var n=[];n.top=t.h/2-e.h/2+e.voffset;n.left=t.w/2-e.w/2+e.hoffset;return n}function churnPaths(e,t){var n=[],r=[];r.w=0;r.m=e.vratio+1;n[0]=[];if(e.slingshot){r.th=Math.round(t.h/2+t.ot-win.h/2);n[0].h=e.smartposition.top-r.th*r.m;n[0].w=e.smartposition.left;n[r.th]=[];n[r.th].h=e.smartposition.top;n[r.th].w=e.smartposition.left;if(e.vratio>0){r.bh=t.ob+t.h-e.smartposition.top-e.h;r.rbh=Math.round(r.bh/r.m);n[r.th+r.rbh]=[];n[r.th+r.rbh].h=n[r.th].h+r.bh;n[r.th+r.rbh].w=e.smartposition.left}else{r.buff=1e5;n[r.th+r.buff]=[];n[r.th+r.buff].h=n[r.th].h+r.buff*r.m;n[r.th+r.buff].w=e.smartposition.left}}else{n[0].h=e.smartposition.top;n[0].w=e.smartposition.left;if(e.vratio>1){r.bh=t.ob+t.h-e.smartposition.top-e.h;r.rbh=Math.round(r.bh/r.m);n[r.rbh]=[];n[r.rbh].h=r.bh;n[r.rbh].w=e.smartposition.left}else{r.buff=1e5;n[r.buff]=[];n[r.buff].h=r.buff*r.m;n[r.buff].w=e.smartposition.left}}return n}function churnTargetDimensions(e){var t=0,n=[];e.ot>=win.h?n.h=win.h+e.h-t:n.h=e.h+e.ot-t;n.w=e.w;return n}function churnSize(e,t){var n,r,i,s,o,u,a;a=Math.abs(e.vratio);if(e.vratio>=0){o=t.target.h+t.target.h*a;if(t.ot+t.config.ploffset>=win.h){console.log(o);o=o}o<t.h*a&&(o=t.h*a)}else{o=t.target.h*a;if(t.ot>=win.h){o=2*t.h*a;o<t.h+t.h*a&&(o=(t.ot+t.h)*a)}}n=e.w/t.target.w;r=n-1;i=e.h/o;s=i-1;var f,l;if(i<1||n<1){if(s<=r){f=1/i;l=f*e.h;return{w:"auto",h:Math.round(l),oHeight:o}}if(s>r){f=1/n;l=f*e.w;return{w:Math.round(l),h:"auto",oHeight:o}}}if(i>=1&&n>=1){if(s<=r){f=1/i;l=f*e.h;return{w:"auto",h:Math.round(l),oHeight:o}}if(s>r){f=1/n;l=f*e.w;return{w:Math.round(l),h:"auto",oHeight:o}}}if(i==1&&n==1)return null}function churnAttributes(e){var t,n;if(e.backdrops){for(t=0;t<e.backdrops.length;t++){n=e.backdrops[t];e.backdrops[t].smartsize=churnSize(n,e);e.backdrops[t].waypoints=churnWaypoints(n,e)}for(t=0;t<e.config.bg_smartsize.length;t++)e.backdrops[t].smartsize.status=e.config.bg_smartsize[t]}if(e.sprites)for(t=0;t<e.sprites.length;t++){n=e.sprites[t];n.smartposition=churnSmartPosition(n,e);n.path=churnPaths(n,e)}}function getDataAttributes(e){var t={},n=/^data\-(.+)$/;jQuery.each(e.get(0).attributes,function(e,r){if(n.test(r.nodeName)){var i=r.nodeName.match(n)[1];t[i]=r.nodeValue}});return t}function pixelize(e){isNaN(e)||(e+="px");return e}function applyAttributes(e){var t,n,r,i,s=[];existingData=getDataAttributes(e.container);for(i in existingData)existingData.hasOwnProperty(i)&&e.container.removeAttr("data-"+i);if(e.backdrops){var o=[];for(t=0;t<e.backdrops.length;t++){r=e.backdrops[t];for(n=0;n<r.waypoints.length;n++){s[r.waypoints[n].index]||(s[r.waypoints[n].index]=[]);s[r.waypoints[n].index].push([pixelize(r.waypoints[n].w),pixelize(r.waypoints[n].h)].join(" "))}r.smartsize.status==1?o.push(pixelize(r.smartsize.w)+" "+pixelize(r.smartsize.h)):o.push("auto auto")}for(i in s)s.hasOwnProperty(i)&&e.container.attr("data-"+i,"background-position: "+s[i].join(",")+";");e.container.css("background-size",o)}if(e.sprites)for(t=0;t<e.sprites.length;t++){r=e.sprites[t];existingData=getDataAttributes(r.element);for(i in existingData)existingData.hasOwnProperty(i)&&r.element.removeAttr("data-"+i);for(i in r.path)r.path.hasOwnProperty(i)&&r.element.attr("data-"+i,"top: "+r.path[i].h+"px; left: "+r.path[i].w+"px;")}}function churnWaypoints(e,t){var n=[];n[0]=[];n[1]=[];if(t.ot+t.config.ploffset>win.h){n[0].index="bottom-top";n[1].index=-t.target.h+"-bottom-top"}else{n[0].index=0;n[1].index=Math.round(t.ot+t.h)}var r=0;e.centered=="1"&&(r="50%");if(e.vratio<=0){n[0].w=r;n[0].h=0;n[1].w=r;n[1].h=-e.smartsize.oHeight+t.h;console.log(466);if(t.ot+t.config.ploffset>=win.h){console.log(468);n[0].h=n[0].h;n[1].h=n[1].h}}else{n[0].w=r;n[1].w=r;n[0].h=-(e.smartsize.oHeight-t.h);n[1].h=-(0-t.h);console.log(478);if(t.ot+t.config.ploffset>=win.h){console.log(480);n[0].h=n[0].h-t.h;n[1].h=n[1].h-t.h}}return n}function engageDepthCharge(e){win=[];doc=[];win.w=jQuery(window).width();win.h=jQuery(window).height();doc.w=jQuery(document).width();doc.h=jQuery("html").height();jQuery.fn.hasAttrMatching=function(e){var t,n;if(!e)return this;typeof e=="string"?t=new RegExp(e):typeof e=="object"&&e.test&&(t=e);return this.filter(function(){n=$(this).data();for(var e in n)if(n.hasOwnProperty(e))return t.test(e)})};jQuery(".depthChargeBlock").each(function(){var e=new Block(jQuery(this))})}var win,doc,Block=function(e){var t;this.container=e;this.config=etc_dc_config[e.attr("id")];this.plid=e.attr("id");this.config.ploffset=jQuery("#navbar").outerHeight()+jQuery("#wpadminbar").outerHeight();this.config.pl==1&&(this.config.ploffset=this.config.ploffset+57);this.config.fullheight=="1"&&e.css("height",jQuery(window).height()-this.config.ploffset);this.h=e.outerHeight();this.w=e.outerWidth();this.ot=Math.round(e.offset().top);this.ob=Math.round(jQuery("body").height()-this.ot-this.h);this.target=churnTargetDimensions(this);var n=e.css("background-image").replace(/url\((['"])?(.*?)\1\)/gi,"$2").split(",");if(n.length>0){this.backdrops=[];for(t=0;t<n.length;t++)this.backdrops[t]=new Backdrop(n[t])}if(this.config.bg_ratio_v)for(t=0;t<this.config.bg_ratio_v.length;t++)this.backdrops[t].vratio=+this.config.bg_ratio_v[t];if(this.config.bg_ratio_h)for(t=0;t<this.config.bg_ratio_h.length;t++)this.backdrops[t].hratio=+this.config.bg_ratio_h[t];if(this.config.bg_centered)for(t=0;t<this.config.bg_centered.length;t++)this.backdrops[t].centered=+this.config.bg_centered[t];this.sprites=[];var r;for(t=0;t<jQuery("#"+this.plid+" .depthChargeSprite").size();t++){this.sprites.push(new Sprite(jQuery("#"+this.plid+" .depthChargeSprite").eq(t)));r=this.sprites[t];r.vratio=+this.config.sp_ratio_v[t];r.voffset=+this.config.sp_offset_v[t];r.hoffset=+this.config.sp_offset_h[t];r.slingshot=this.config.sp_slingshot[t]}churnAttributes(this);applyAttributes(this)},Backdrop=function(e){var t=new Image;t.src=e;this.h=t.height;this.w=t.width},Pane=function(e){this.container=e},Sprite=function(e){this.element=e;this.h=e.outerHeight();this.w=e.outerWidth()};window.onload=function(){engageDepthCharge();var e=skrollr.init({forceHeight:!1,smoothScroll:!0,smoothScrollingDuration:200});jQuery(".depthChargeSprite .slabtext")[0]&&jQuery(".depthChargeSprite h1").slabText({viewportBreakpoint:380})};window.onresize=function(){engageDepthCharge();skrollr.get().refresh()};